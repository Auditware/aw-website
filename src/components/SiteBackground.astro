---
import { themes } from '../styles/themes.ts';

interface GradientPosition {
  top?: string;
  bottom?: string;
  left?: string;
  right?: string;
  width: string;
  height: string;
}

type GradientPositions = {
  gradient1: GradientPosition;
  gradient2: GradientPosition;
  gradient3: GradientPosition;
};

// Page-specific gradient positioning configurations
const PAGE_GRADIENT_POSITIONS: Record<string, GradientPositions> = {
  'audit-wizard': {
    gradient1: { top: '-15%', left: '-40%', width: '80%', height: '110%' },
    gradient2: { bottom: '-15%', right: '-25%', width: '65%', height: '75%' },
    gradient3: { top: '50%', left: '30%', width: '50%', height: '60%' }
  },
  'sentry': {
    gradient1: { top: '-25%', right: '25%', width: '90%', height: '110%' },
    gradient2: { bottom: '-20%', left: '30%', width: '85%', height: '95%' },
    gradient3: { top: '50%', right: '-8%', width: '65%', height: '70%' }
  },
  'radar': {
    gradient1: { top: '-35%', left: '10%', width: '85%', height: '105%' },
    gradient2: { bottom: '-25%', right: '10%', width: '60%', height: '80%' },
    gradient3: { top: '50%', left: '-10%', width: '50%', height: '70%' }
  },
  'audits': {
    gradient1: { top: '-25%', right: '5%', width: '90%', height: '95%' },
    gradient2: { bottom: '-35%', left: '-20%', width: '75%', height: '90%' },
    gradient3: { top: '35%', right: '-5%', width: '60%', height: '75%' }
  },
  'home': {
    gradient1: { top: '-15%', right: '15%', width: '75%', height: '95%' },
    gradient2: { bottom: '-10%', left: '10%', width: '80%', height: '85%' },
    gradient3: { top: '55%', right: '-10%', width: '70%', height: '80%' }
  }
};

// Determine theme and positioning based on path
const currentPath = Astro.url.pathname;
let pageKey = 'home';
let theme = themes.home;

if (currentPath.includes('/audit-wizard')) {
  pageKey = 'audit-wizard';
  theme = themes['audit-wizard'];
} else if (currentPath.includes('/sentry')) {
  pageKey = 'sentry';
  theme = themes.sentry;
} else if (currentPath.includes('/radar')) {
  pageKey = 'radar';
  theme = themes.radar;
} else if (currentPath.includes('/audits')) {
  pageKey = 'audits';
  theme = themes.audits;
}

const gradientPositions = PAGE_GRADIENT_POSITIONS[pageKey];
const { palette } = theme;
const gradient1 = palette.semantic.background.gradient1;
const gradient2 = palette.semantic.background.gradient2;
const gradient3 = palette.semantic.background.gradient3;

// Helper to build gradient style string
function buildGradientStyle(
  color: string, 
  opacity: number, 
  position: GradientPosition & { shape?: 'ellipse' | 'circle'; fade?: number }
): string {
  const shape = position.shape || 'ellipse';
  const fade = position.fade || 70;
  const styles = [
    `background: radial-gradient(${shape}, rgba(${color}, ${opacity}) 0%, transparent ${fade}%)`,
    position.top && `top: ${position.top}`,
    position.bottom && `bottom: ${position.bottom}`,
    position.left && `left: ${position.left}`,
    position.right && `right: ${position.right}`,
    `width: ${position.width}`,
    `height: ${position.height}`
  ].filter(Boolean).join('; ');
  
  return styles;
}
---

<div class="site-background">
  <div 
    class="site-background-gradient-1"
    style={buildGradientStyle(gradient1.color, 0.15, gradientPositions.gradient1)}
  ></div>
  <div 
    class="site-background-gradient-2"
    style={buildGradientStyle(gradient2.color, 0.12, gradientPositions.gradient2)}
  ></div>
  <div 
    class="site-background-gradient-3"
    style={buildGradientStyle(gradient3.color, 0.1, { ...gradientPositions.gradient3, shape: 'circle' as const, fade: 75 })}
  ></div>
  <div class="site-background-dots"></div>
</div>

<style>
  .site-background {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: -1;
    background: #000000;
  }

  .site-background-gradient-1,
  .site-background-gradient-2,
  .site-background-gradient-3 {
    position: absolute;
    pointer-events: none;
    z-index: 0;
  }

  .site-background-dots {
    position: absolute;
    inset: 0;
    opacity: 0.15;
    background-image: radial-gradient(circle at 25px 25px, rgba(255,255,255,0.4) 2px, transparent 0);
    background-size: 50px 50px;
    pointer-events: none;
    z-index: 1;
  }
</style>

