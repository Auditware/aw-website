---
import { Image } from 'astro:assets';

export interface ColorScheme {
  // Gradient text colors (5 stops)
  gradientText: {
    stop1: string;
    stop2: string;
    stop3: string;
    stop4: string;
    stop5: string;
  };
  // Button colors
  button: {
    primary: { start: string; end: string };
    primaryHover: { start: string; end: string };
    border: { color: string; opacity: number };
  };
  // Text colors
  text: {
    title: string; // RGB color for main title text
    description: string; // RGB color for description text
  };
  // Accent colors
  accent: {
    imageBorder: { color: string; opacity: number };
    imageGlow: { start: string; startOpacity: number; end: string; endOpacity: number };
    dotPattern: { color: string; opacity: number };
    gridPattern: { color: string; opacity: number };
    badge: { color: string; opacity: number };
  };
}

export interface Props {
  title: string;
  subtitle?: string;
  description: string;
  primaryCta: {
    text: string;
    href: string;
  };
  secondaryCta?: {
    text: string;
    href: string;
  };
  imageUrl?: string;
  imageAlt?: string;
  badges?: Array<{
    text: string;
    href?: string;
    icon?: string;
  }>;
  colorScheme?: ColorScheme;
}

// Default purple color scheme
const defaultColorScheme: ColorScheme = {
  gradientText: {
    stop1: '255, 255, 255', // Pure white
    stop2: '255, 255, 255', // Pure white
    stop3: '250, 245, 255', // Very light purple
    stop4: '243, 232, 255', // Light purple
    stop5: '233, 213, 255', // Subtle purple
  },
  button: {
    primary: { start: '139, 92, 246', end: '124, 58, 237' },
    primaryHover: { start: '167, 139, 250', end: '139, 92, 246' },
    border: { color: '139, 92, 246', opacity: 0.4 },
  },
  text: {
    title: '255, 255, 255', // White for title
    description: '160, 160, 160', // Default gray for description
  },
  accent: {
    imageBorder: { color: '139, 92, 246', opacity: 0.3 },
    imageGlow: { start: '124, 58, 237', startOpacity: 0.8, end: '139, 92, 246', endOpacity: 0.6 },
    dotPattern: { color: '255, 255, 255', opacity: 0.4 },
    gridPattern: { color: '255, 255, 255', opacity: 0.04 },
    badge: { color: '139, 92, 246', opacity: 0.2 },
  },
};

const { 
  title, 
  subtitle, 
  description, 
  primaryCta, 
  secondaryCta, 
  imageUrl, 
  imageAlt = '', 
  badges = [],
  colorScheme = defaultColorScheme
} = Astro.props;

const cs = colorScheme;
---

<section class="hero" style={`
  --gradient-text-1: ${cs.gradientText.stop1};
  --gradient-text-2: ${cs.gradientText.stop2};
  --gradient-text-3: ${cs.gradientText.stop3};
  --gradient-text-4: ${cs.gradientText.stop4};
  --gradient-text-5: ${cs.gradientText.stop5};
  --button-primary-start: ${cs.button.primary.start};
  --button-primary-end: ${cs.button.primary.end};
  --button-primary-hover-start: ${cs.button.primaryHover.start};
  --button-primary-hover-end: ${cs.button.primaryHover.end};
  --button-border-color: ${cs.button.border.color};
  --button-border-opacity: ${cs.button.border.opacity};
  --image-border-color: ${cs.accent.imageBorder.color};
  --image-border-opacity: ${cs.accent.imageBorder.opacity};
  --image-glow-start: ${cs.accent.imageGlow.start};
  --image-glow-start-opacity: ${cs.accent.imageGlow.startOpacity};
  --image-glow-end: ${cs.accent.imageGlow.end};
  --image-glow-end-opacity: ${cs.accent.imageGlow.endOpacity};
  --dot-pattern-color: ${cs.accent.dotPattern.color};
  --dot-pattern-opacity: ${cs.accent.dotPattern.opacity};
  --grid-pattern-color: ${cs.accent.gridPattern.color};
  --grid-pattern-opacity: ${cs.accent.gridPattern.opacity};
  --badge-color: ${cs.accent.badge.color};
  --badge-opacity: ${cs.accent.badge.opacity};
  --title-color: ${cs.text.title};
  --description-color: ${cs.text.description};
`}>
  <div class="container">
    <div class="hero-content">
      <div class="hero-stack">
        <div class="hero-text">
          {subtitle && (
            <div class="hero-subtitle-badge">
              <span class="badge">{subtitle}</span>
            </div>
          )}
          
          <h1 class="hero-title">
            <span set:html={title} />
          </h1>
          
          <p class="hero-description body-large">
            {description}
          </p>
          
          {badges.length > 0 && (
            <div class="hero-badges">
              {badges.map((badge) => (
                <a href={badge.href} class="framework-badge-icon-link" target="_blank" rel="noopener noreferrer" title={badge.text}>
                  {badge.icon && (
                    badge.icon.startsWith('http') ? (
                      <img src={badge.icon} alt={badge.text} class="framework-badge-icon" width="48" height="48" loading="lazy" />
                    ) : (
                      <Image src={badge.icon} alt={badge.text} class="framework-badge-icon" width={48} height={48} loading="lazy" />
                    )
                  )}
                </a>
              ))}
            </div>
          )}
          
          <div class="hero-cta">
            <a href={primaryCta.href} class="btn btn-primary btn-lg">
              {primaryCta.text}
              <svg class="btn-arrow" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M6 12L10 8L6 4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </a>
            {secondaryCta && (
              <a href={secondaryCta.href} class="btn btn-secondary btn-lg">
                {secondaryCta.text}
                <svg class="btn-arrow" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M3 8H13M13 8L9 4M13 8L9 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </a>
            )}
          </div>
        </div>
        
        {imageUrl && (
          <div class="hero-visual">
            <div class="hero-image-container">
              {imageUrl.startsWith('http') ? (
                <img 
                  src={imageUrl} 
                  alt={imageAlt}
                  class="hero-image"
                  loading="eager"
                  fetchpriority="high"
                />
              ) : (
                <Image 
                  src={imageUrl} 
                  alt={imageAlt}
                  class="hero-image"
                  width={650}
                  height={450}
                  loading="eager"
                  format="webp"
                  fetchpriority="high"
                />
              )}
              <div class="hero-image-glow"></div>
            </div>
          </div>
        )}
      </div>
    </div>
  </div>
  
  <!-- Background Elements -->
  <div class="hero-bg-elements">
    <div class="hero-grid-pattern"></div>
    <div class="hero-dotted-pattern"></div>
  </div>
</section>

<style>
  .hero {
    position: relative;
    display: flex;
    align-items: center;
    background: transparent;
    overflow: visible;
    padding: var(--spacing-10) 0 var(--spacing-12);
    border-bottom: 1px solid var(--color-border-primary);
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
  }
  
  .hero-content {
    position: relative;
    z-index: 1;
    width: 100%;
    max-width: 100%;
    overflow: visible;
    box-sizing: border-box;
  }
  
  .hero-stack {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: var(--spacing-12);
    width: 100%;
    max-width: 100%;
    overflow: visible;
    box-sizing: border-box;
    position: relative;
  }
  
  /* Ensure container doesn't clip content */
  .hero .container {
    overflow: visible;
    overflow-x: visible;
    overflow-y: visible;
    max-width: 100%;
  }
  
  .hero-text {
    max-width: 720px;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 2;
    width: 100%;
    overflow: visible;
    box-sizing: border-box;
  }
  
  /* Subtle overlay to reduce background pattern noise behind text */
  .hero-text::before {
    content: '';
    position: absolute;
    top: -20%;
    left: -10%;
    right: -10%;
    bottom: -20%;
    background: radial-gradient(ellipse at center, rgba(0, 0, 0, 0.15) 0%, transparent 70%);
    pointer-events: none;
    z-index: -1;
    overflow: hidden;
  }
  
  .hero-subtitle-badge {
    margin-bottom: var(--spacing-8);
    animation: fade-in-up 1s cubic-bezier(0.16, 1, 0.3, 1) backwards;
    will-change: opacity, transform;
  }
  
  .hero-title {
    font-size: clamp(2.5rem, 5vw, 5rem);
    font-weight: var(--font-weight-black);
    line-height: 1.1;
    margin-top: 0;
    margin-bottom: var(--spacing-8);
    letter-spacing: -0.03em;
    animation: fade-in-up 1.2s 0.1s cubic-bezier(0.16, 1, 0.3, 1) backwards;
    text-wrap: balance;
    font-feature-settings: 'liga' 1, 'kern' 1;
    will-change: opacity, transform;
    background: linear-gradient(
      135deg,
      rgb(var(--gradient-text-1)) 0%,
      rgb(var(--gradient-text-2)) 25%,
      rgb(var(--gradient-text-3)) 50%,
      rgb(var(--gradient-text-4)) 75%,
      rgb(var(--gradient-text-5)) 100%
    );
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-style: normal;
  }
  
  .hero-description {
    margin-bottom: var(--spacing-8);
    max-width: 600px;
    font-size: var(--font-size-xl);
    line-height: var(--line-height-normal);
    color: rgb(var(--description-color));
    animation: fade-in-up 1.1s 0.15s cubic-bezier(0.16, 1, 0.3, 1) backwards;
    will-change: opacity, transform;
  }
  
  .hero-badges {
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    gap: var(--spacing-5);
    margin-bottom: var(--spacing-8);
    justify-content: center;
    animation: fade-in-up 1.1s 0.2s cubic-bezier(0.16, 1, 0.3, 1) backwards;
    will-change: opacity, transform;
  }
  
  .hero-cta {
    display: flex;
    gap: var(--spacing-4);
    flex-wrap: wrap;
    justify-content: center;
    margin-bottom: 0;
    animation: fade-in-up 1.1s 0.25s cubic-bezier(0.16, 1, 0.3, 1) backwards;
    will-change: opacity, transform;
    overflow: visible;
    padding: var(--spacing-2) 0;
    position: relative;
  }
  
  .hero-visual {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: var(--spacing-5);
    animation: fade-in 1.4s 0.3s cubic-bezier(0.16, 1, 0.3, 1) backwards;
    position: relative;
    z-index: 1;
    will-change: opacity;
    width: 100%;
    max-width: 100%;
    overflow: visible;
    box-sizing: border-box;
  }
  
  .hero-image-container {
    position: relative;
    max-width: 800px;
    width: 100%;
    aspect-ratio: 650 / 450;
    min-height: 450px;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: visible;
    box-sizing: border-box;
  }
  
  /* Vignette effect removed */
  
  .hero-image {
    width: 100%;
    height: 100%;
    object-fit: contain;
    border-radius: var(--radius-lg);
    position: relative;
    z-index: 1;
    display: block;
    max-width: 100%;
    box-sizing: border-box;
    /* Subtle grounding shadow that blends with dark background */
    filter: drop-shadow(0 8px 32px rgba(0, 0, 0, 0.4)) 
            drop-shadow(0 4px 16px rgba(0, 0, 0, 0.3))
            drop-shadow(0 2px 8px rgba(0, 0, 0, 0.2));
  }
  
  /* Very subtle ambient glow - much more restrained */
  .hero-image-glow {
    position: absolute;
    top: 5%;
    left: 5%;
    right: 5%;
    bottom: 5%;
    background: radial-gradient(
      ellipse at center,
      rgba(var(--image-glow-start), calc(var(--image-glow-start-opacity) * 0.15)) 0%,
      rgba(var(--image-glow-end), calc(var(--image-glow-end-opacity) * 0.15)) 50%,
      transparent 100%
    );
    border-radius: var(--radius-lg);
    opacity: 0.08;
    filter: blur(60px);
    z-index: 0;
    pointer-events: none;
    overflow: hidden;
  }
  
  /* Background Elements */
  .hero-bg-elements {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    z-index: 0;
  }

  /* Dynamic Button Styling */
  .hero .btn-primary {
    background: linear-gradient(135deg, rgb(var(--button-primary-start)) 0%, rgb(var(--button-primary-end)) 100%);
    border-color: rgba(var(--button-border-color), var(--button-border-opacity));
    box-shadow: 0 0 0 1px rgba(var(--button-border-color), calc(var(--button-border-opacity) * 0.5)), 
                0 4px 20px rgba(var(--button-primary-start), 0.3);
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1), 
                box-shadow 0.25s cubic-bezier(0.4, 0, 0.2, 1),
                transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .hero .btn-primary:hover {
    background: linear-gradient(135deg, rgb(var(--button-primary-hover-start)) 0%, rgb(var(--button-primary-hover-end)) 100%);
    border-color: rgba(var(--button-border-color), calc(var(--button-border-opacity) + 0.1));
    box-shadow: 0 0 0 1px rgba(var(--button-border-color), calc(var(--button-border-opacity) + 0.1)), 
                0 12px 40px rgba(var(--button-primary-start), 0.5),
                0 4px 16px rgba(var(--button-primary-start), 0.3);
    transform: translateY(-2px) scale(1.01);
    transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1),
                box-shadow 0.5s cubic-bezier(0.16, 1, 0.3, 1),
                transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
  }
  
  /* Arrow icon animation */
  .hero .btn-primary .btn-arrow {
    transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    display: inline-block;
  }
  
  .hero .btn-primary:hover .btn-arrow {
    transform: translateX(2px);
    transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
  }
  
  .hero .btn-primary:focus {
    outline: none;
  }
  
  .hero .btn-primary:focus-visible {
    outline: 2px solid var(--color-primary-400);
    outline-offset: 2px;
  }
  
  .hero .btn-secondary {
    background: rgba(var(--button-primary-start), 0.1);
    border-color: rgba(var(--button-border-color), var(--button-border-opacity));
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1),
                box-shadow 0.25s cubic-bezier(0.4, 0, 0.2, 1),
                transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  .hero .btn-secondary:hover {
    background: rgba(var(--button-primary-start), 0.15);
    border-color: rgba(var(--button-border-color), calc(var(--button-border-opacity) + 0.1));
    box-shadow: 0 8px 24px rgba(var(--button-primary-start), 0.3),
                0 4px 12px rgba(var(--button-primary-start), 0.2);
    transform: translateY(-2px) scale(1.01);
    transition: all 0.5s cubic-bezier(0.16, 1, 0.3, 1),
                box-shadow 0.5s cubic-bezier(0.16, 1, 0.3, 1),
                transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
  }
  
  /* Arrow icon animation for secondary button */
  .hero .btn-secondary .btn-arrow {
    transition: transform 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    display: inline-block;
  }
  
  .hero .btn-secondary:hover .btn-arrow {
    transform: translateX(2px);
    transition: transform 0.5s cubic-bezier(0.16, 1, 0.3, 1);
  }
  
  .hero .btn-secondary:focus {
    outline: none;
  }
  
  .hero .btn-secondary:focus-visible {
    outline: 2px solid var(--color-primary-400);
    outline-offset: 2px;
  }

  /* Dynamic Badge Styling */
  .hero .badge {
    background: rgba(var(--badge-color), var(--badge-opacity));
    border-color: rgba(var(--button-border-color), var(--button-border-opacity));
  }

  .hero .badge:hover {
    background: rgba(var(--badge-color), calc(var(--badge-opacity) + 0.1));
    border-color: rgba(var(--button-border-color), calc(var(--button-border-opacity) + 0.1));
  }
  
  .hero-grid-pattern {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: 
      radial-gradient(circle at 1px 1px, rgba(var(--grid-pattern-color), var(--grid-pattern-opacity)) 1px, transparent 0);
    background-size: 48px 48px;
    opacity: 0.25;
  }

  /* Dotted Background Pattern */
  .hero-dotted-pattern {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    opacity: 0.15;
    background-image: radial-gradient(circle at 25px 25px, rgba(var(--dot-pattern-color), var(--dot-pattern-opacity)) 2px, transparent 0);
    background-size: 50px 50px;
    pointer-events: none;
    z-index: -1;
    overflow: hidden;
  }
  
  
  /* Responsive Design */
  @media (max-width: 1199px) {
    .hero-stack {
      gap: var(--spacing-10);
    }
    
    .hero-text {
      max-width: 100%;
    }
    
    .hero-image-container {
      max-width: 100%;
    }
  }
  
  @media (max-width: 767px) {
    .hero {
      padding: var(--spacing-8) 0 var(--spacing-10);
    }
    
    .hero-stack {
      gap: var(--spacing-10);
    }
    
    .hero-title {
      margin-bottom: var(--spacing-6);
      letter-spacing: -0.025em;
    }
    
    .hero-description {
      font-size: var(--font-size-lg);
      margin-bottom: var(--spacing-6);
      line-height: var(--line-height-normal);
    }
    
    .hero-badges {
      margin-bottom: var(--spacing-6);
    }
    
    .hero-visual {
      margin-top: var(--spacing-4);
    }
    
    .hero-cta {
      flex-direction: column;
      align-items: center;
    }
    
    .hero-cta {
      gap: var(--spacing-3);
    }
    
    .hero-cta .btn {
      width: 100%;
      max-width: 100%;
      min-height: 48px;
      padding: var(--spacing-4) var(--spacing-6);
    }
    
    .hero-cta .btn-lg {
      min-height: 48px;
    }
  }
  
  @media (max-width: 479px) {
    .hero {
      padding: var(--spacing-6) 0 var(--spacing-8);
    }
    
    .hero-stack {
      gap: var(--spacing-8);
    }
    
    .hero-badges {
      gap: var(--spacing-3);
    }
    
    .hero-description {
      font-size: var(--font-size-base);
      margin-bottom: var(--spacing-6);
    }
    
    .hero-visual {
      margin-top: var(--spacing-4);
    }
    
    .hero-badges {
      gap: var(--spacing-3);
    }
    
    .framework-badge-icon-link {
      min-width: 48px;
      min-height: 48px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      touch-action: manipulation;
    }
    
    .framework-badge-icon-link .framework-badge-icon {
      height: 48px;
      width: auto;
    }
    
    .framework-badge-icon-link:nth-child(2) .framework-badge-icon {
      height: 38px;
    }
  }
</style>
